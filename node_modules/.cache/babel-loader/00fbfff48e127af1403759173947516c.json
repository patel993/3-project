{"ast":null,"code":"import _regeneratorRuntime from\"/home/xlandroid1/Desktop/react data/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/xlandroid1/Desktop/react data/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{Fragment,useEffect,useRef}from\"react\";import CheckoutSteps from\"../Cart/CheckoutSteps\";import{useSelector,useDispatch}from\"react-redux\";import MetaData from\"../layout/MetaData\";import{Typography}from\"@material-ui/core\";import{useAlert}from\"react-alert\";import{CardNumberElement,CardCvcElement,CardExpiryElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import axios from\"axios\";import\"./payment.css\";import CreditCardIcon from\"@material-ui/icons/CreditCard\";import EventIcon from\"@material-ui/icons/Event\";import VpnKeyIcon from\"@material-ui/icons/VpnKey\";import{createOrder,clearErrors}from\"../../actions/orderAction\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Payment=function Payment(_ref){var history=_ref.history;var orderInfo=JSON.parse(sessionStorage.getItem(\"orderInfo\"));var dispatch=useDispatch();var alert=useAlert();var stripe=useStripe();var elements=useElements();var payBtn=useRef(null);var _useSelector=useSelector(function(state){return state.cart;}),shippingInfo=_useSelector.shippingInfo,cartItems=_useSelector.cartItems;var _useSelector2=useSelector(function(state){return state.user;}),user=_useSelector2.user;var _useSelector3=useSelector(function(state){return state.newOrder;}),error=_useSelector3.error;var paymentData={amount:Math.round(orderInfo.totalPrice*100)};var order={shippingInfo:shippingInfo,orderItems:cartItems,itemsPrice:orderInfo.subtotal,taxPrice:orderInfo.tax,shippingPrice:orderInfo.shippingCharges,totalPrice:orderInfo.totalPrice};var submitHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var config,_yield$axios$post,data,client_secret,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();payBtn.current.disabled=true;_context.prev=2;config={headers:{\"Content-Type\":\"application/json\"}};_context.next=6;return axios.post(\"/api/v1/payment/process\",paymentData,config);case 6:_yield$axios$post=_context.sent;data=_yield$axios$post.data;client_secret=data.client_secret;if(!(!stripe||!elements)){_context.next=11;break;}return _context.abrupt(\"return\");case 11:_context.next=13;return stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email,address:{line1:shippingInfo.address,city:shippingInfo.city,state:shippingInfo.state,postal_code:shippingInfo.pinCode,country:shippingInfo.country}}}});case 13:result=_context.sent;if(result.error){payBtn.current.disabled=false;alert.error(result.error.message);}else{if(result.paymentIntent.status===\"succeeded\"){order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(createOrder(order));history.push(\"/success\");}else{alert.error(\"There's some issue while processing payment \");}}_context.next=21;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](2);payBtn.current.disabled=false;alert.error(_context.t0.response.data.message);case 21:case\"end\":return _context.stop();}}},_callee,null,[[2,17]]);}));return function submitHandler(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){if(error){alert.error(error);dispatch(clearErrors());}},[dispatch,error,alert]);return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:\"Payment\"}),/*#__PURE__*/_jsx(CheckoutSteps,{activeStep:2}),/*#__PURE__*/_jsx(\"div\",{className:\"paymentContainer\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"paymentForm\",onSubmit:function onSubmit(e){return submitHandler(e);},children:[/*#__PURE__*/_jsx(Typography,{children:\"Card Info\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CreditCardIcon,{}),/*#__PURE__*/_jsx(CardNumberElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(EventIcon,{}),/*#__PURE__*/_jsx(CardExpiryElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(VpnKeyIcon,{}),/*#__PURE__*/_jsx(CardCvcElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"Pay - \\u20B9\".concat(orderInfo&&orderInfo.totalPrice),ref:payBtn,className:\"paymentFormBtn\"})]})})]});};export default Payment;","map":{"version":3,"sources":["/home/xlandroid1/Desktop/react data/frontend/src/component/Cart/Payment.js"],"names":["React","Fragment","useEffect","useRef","CheckoutSteps","useSelector","useDispatch","MetaData","Typography","useAlert","CardNumberElement","CardCvcElement","CardExpiryElement","useStripe","useElements","axios","CreditCardIcon","EventIcon","VpnKeyIcon","createOrder","clearErrors","Payment","history","orderInfo","JSON","parse","sessionStorage","getItem","dispatch","alert","stripe","elements","payBtn","state","cart","shippingInfo","cartItems","user","newOrder","error","paymentData","amount","Math","round","totalPrice","order","orderItems","itemsPrice","subtotal","taxPrice","tax","shippingPrice","shippingCharges","submitHandler","e","preventDefault","current","disabled","config","headers","post","data","client_secret","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","address","line1","city","postal_code","pinCode","country","result","message","paymentIntent","status","paymentInfo","id","push","response"],"mappings":"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","sourcesContent":["import React, { Fragment, useEffect, useRef } from \"react\";\nimport CheckoutSteps from \"../Cart/CheckoutSteps\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport MetaData from \"../layout/MetaData\";\nimport { Typography } from \"@material-ui/core\";\nimport { useAlert } from \"react-alert\";\nimport {\n  CardNumberElement,\n  CardCvcElement,\n  CardExpiryElement,\n  useStripe,\n  useElements,\n} from \"@stripe/react-stripe-js\";\n\nimport axios from \"axios\";\nimport \"./payment.css\";\nimport CreditCardIcon from \"@material-ui/icons/CreditCard\";\nimport EventIcon from \"@material-ui/icons/Event\";\nimport VpnKeyIcon from \"@material-ui/icons/VpnKey\";\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\n\nconst Payment = ({ history }) => {\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\n\n  const dispatch = useDispatch();\n  const alert = useAlert();\n  const stripe = useStripe();\n  const elements = useElements();\n  const payBtn = useRef(null);\n\n  const { shippingInfo, cartItems } = useSelector((state) => state.cart);\n  const { user } = useSelector((state) => state.user);\n  const { error } = useSelector((state) => state.newOrder);\n\n  const paymentData = {\n    amount: Math.round(orderInfo.totalPrice * 100),\n  };\n\n  const order = {\n    shippingInfo,\n    orderItems: cartItems,\n    itemsPrice: orderInfo.subtotal,\n    taxPrice: orderInfo.tax,\n    shippingPrice: orderInfo.shippingCharges,\n    totalPrice: orderInfo.totalPrice,\n  };\n\n  const submitHandler = async (e) => {\n    e.preventDefault();\n\n    payBtn.current.disabled = true;\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      };\n      const { data } = await axios.post(\n        \"/api/v1/payment/process\",\n        paymentData,\n        config\n      );\n\n      const client_secret = data.client_secret;\n\n      if (!stripe || !elements) return;\n\n      const result = await stripe.confirmCardPayment(client_secret, {\n        payment_method: {\n          card: elements.getElement(CardNumberElement),\n          billing_details: {\n            name: user.name,\n            email: user.email,\n            address: {\n              line1: shippingInfo.address,\n              city: shippingInfo.city,\n              state: shippingInfo.state,\n              postal_code: shippingInfo.pinCode,\n              country: shippingInfo.country,\n            },\n          },\n        },\n      });\n\n      if (result.error) {\n        payBtn.current.disabled = false;\n\n        alert.error(result.error.message);\n      } else {\n        if (result.paymentIntent.status === \"succeeded\") {\n          order.paymentInfo = {\n            id: result.paymentIntent.id,\n            status: result.paymentIntent.status,\n          };\n\n          dispatch(createOrder(order));\n\n          history.push(\"/success\");\n        } else {\n          alert.error(\"There's some issue while processing payment \");\n        }\n      }\n    } catch (error) {\n      payBtn.current.disabled = false;\n      alert.error(error.response.data.message);\n    }\n  };\n\n  useEffect(() => {\n    if (error) {\n      alert.error(error);\n      dispatch(clearErrors());\n    }\n  }, [dispatch, error, alert]);\n\n  return (\n    <Fragment>\n      <MetaData title=\"Payment\" />\n      <CheckoutSteps activeStep={2} />\n      <div className=\"paymentContainer\">\n        <form className=\"paymentForm\" onSubmit={(e) => submitHandler(e)}>\n          <Typography>Card Info</Typography>\n          <div>\n            <CreditCardIcon />\n            <CardNumberElement className=\"paymentInput\" />\n          </div>\n          <div>\n            <EventIcon />\n            <CardExpiryElement className=\"paymentInput\" />\n          </div>\n          <div>\n            <VpnKeyIcon />\n            <CardCvcElement className=\"paymentInput\" />\n          </div>\n\n          <input\n            type=\"submit\"\n            value={`Pay - â‚¹${orderInfo && orderInfo.totalPrice}`}\n            ref={payBtn}\n            className=\"paymentFormBtn\"\n          />\n        </form>\n      </div>\n    </Fragment>\n  );\n};\n\nexport default Payment;\n"]},"metadata":{},"sourceType":"module"}